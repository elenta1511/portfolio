(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{424:function(t,r,e){},445:function(t,r,e){"use strict";var o=e(424);e.n(o).a},466:function(t,r,e){"use strict";e.r(r);var o=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"form-block"},[e("h2",{staticClass:"form-block__title"},[t._v(t._s(t.WorkTitle))]),e("hr"),e("form",{staticClass:"form work-form form-block__content form-block__content--work"},[e("div",{staticClass:"form__photo form__photo--work",class:{photo_uploaded:this.renderedPhotoUrl.length,error:t.validation.firstError("renderedPhotoUrl")},style:{backgroundImage:"url("+this.renderedPhotoUrl+")"}},[e("label",{staticClass:"form__upload-photo-wrapper"},[e("div",{staticClass:"form__upload-photo-container"},[e("input",{staticClass:"form__upload-photo-input",attrs:{type:"file"},on:{change:t.appendPhoto}}),e("div",{staticClass:"form__upload-photo-error"},[e("errorsTooltip",{attrs:{errorText:t.validation.firstError("renderedPhotoUrl")}})],1),t._m(0)])])]),e("div",{staticClass:"form__text form__text--work"},[e("div",{staticClass:"form__row"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block",class:{error:t.validation.firstError("work.title")}},[e("span",{staticClass:"form__label"},[t._v("Название")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.work.title,expression:"work.title"}],staticClass:"form__input form__input--title",attrs:{id:"title",type:"text",name:"title",placeholder:"Введите название работы"},domProps:{value:t.work.title},on:{input:function(r){r.target.composing||t.$set(t.work,"title",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("errorsTooltip",{attrs:{errorText:t.validation.firstError("work.title")}})],1)])])]),e("div",{staticClass:"form__row"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block",class:{error:t.validation.firstError("work.link")}},[e("span",{staticClass:"form__label"},[t._v("Ссылка")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.work.link,expression:"work.link"}],staticClass:"form__input form__input--link",attrs:{id:"link",type:"text",name:"link",placeholder:"Вставьте ссылку"},domProps:{value:t.work.link},on:{input:function(r){r.target.composing||t.$set(t.work,"link",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("errorsTooltip",{attrs:{errorText:t.validation.firstError("work.link")}})],1)])])]),e("div",{staticClass:"form__row form__row--textarea"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block form__text-block--textarea",class:{error:t.validation.firstError("work.description")}},[e("span",{staticClass:"form__label"},[t._v("Описание")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.work.description,expression:"work.description"}],staticClass:"form__textarea",attrs:{id:"description",name:"description",rows:"4",placeholder:"Введите описание работы"},domProps:{value:t.work.description},on:{input:function(r){r.target.composing||t.$set(t.work,"description",r.target.value)}}}),e("div",{staticClass:"form__text-block-error form__text-block-error--textarea"},[e("errorsTooltip",{attrs:{errorText:t.validation.firstError("work.description")}})],1)])])]),e("div",{staticClass:"form__row form__row--tags"},[e("div",{staticClass:"form__col"},[e("label",{staticClass:"form__text-block",class:{error:t.validation.firstError("editedTagsAsString")},attrs:{for:"tags"}},[e("span",{staticClass:"form__label"},[t._v("Добавление тега")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.work.techs,expression:"work.techs"}],staticClass:"form__input form__input--tags",attrs:{id:"tags",type:"text",name:"tags",placeholder:"Добавьте теги"},domProps:{value:t.work.techs},on:{change:function(r){return t.ADD_TAGS(t.work.techs)},input:function(r){r.target.composing||t.$set(t.work,"techs",r.target.value)}}}),e("div",{staticClass:"form__text-block-error"},[e("errorsTooltip",{attrs:{errorText:t.validation.firstError("editedTagsAsString")}})],1)])])]),e("div",{staticClass:"form__row"},[t.WorkForm.editMode?e("div",{staticClass:"form__col"},[e("formTags")],1):t._e()]),e("div",{staticClass:"form__row form__row--btns"},[e("div",{staticClass:"form__col"},[e("div",{staticClass:"form__btns"},[e("button",{staticClass:"btn btn--cancel-edit",attrs:{type:"button"},on:{click:t.CLOSE_FORM}},[t._v("Отмена")]),t.WorkForm.editMode?t._e():e("button",{staticClass:"btn btn--save-edit",attrs:{type:"button"},on:{click:t.addNewWork}},[t._v("Сохранить")]),t.WorkForm.editMode?e("button",{staticClass:"btn btn--save-edit",attrs:{type:"button"},on:{click:t.saveEditedWork}},[t._v("Сохранить")]):t._e()])])])])])])};o._withStripped=!0;var i=e(130),s=e(324);function a(t,r,e,o,i,s,a){try{var n=t[s](a),l=n.value}catch(t){return void e(t)}n.done?r(l):Promise.resolve(l).then(o,i)}function n(t){return function(){var r=this,e=arguments;return new Promise(function(o,i){var s=t.apply(r,e);function n(t){a(s,o,i,n,l,"next",t)}function l(t){a(s,o,i,n,l,"throw",t)}n(void 0)})}}function l(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{},o=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.forEach(function(r){c(t,r,e[r])})}return t}function c(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var d={mixins:[e(324).mixin],validators:{renderedPhotoUrl:function(t){return s.Validator.value(t).required("Загрузите фото")},"work.title":function(t){return s.Validator.value(t).required("Введите название")},"work.link":function(t){return s.Validator.value(t).required("Вставьте ссылку")},"work.description":function(t){return s.Validator.value(t).required("Введите описание")},editedTagsAsString:function(t){return s.Validator.value(t).required("Укажите хотя бы один тег")}},components:{formTags:function(){return e.e(18).then(e.bind(null,474))},errorsTooltip:function(){return e.e(0).then(e.bind(null,472))}},data:function(){return{renderedPhotoUrl:"",work:{title:"",techs:"",photo:"",link:"",description:""}}},computed:l({},Object(i.d)("works",{WorkForm:function(t){return t.WorkForm},editedWork:function(t){return t.editedWork},editedTags:function(t){return t.editedTags}}),{WorkTitle:function(){switch(this.WorkForm.editMode){case!0:return"Редактирование работы";case!1:return"Добавление работы"}},remotePhotoPath:function(){return"https://webdev-api.loftschool.com".concat("/",this.work.photo)},editedTagsAsString:function(){return this.editedTags.join(",")}}),methods:l({},Object(i.b)("works",["addWork","editWork"]),Object(i.c)("works",["CLOSE_FORM","ADD_TAGS"]),Object(i.c)("tooltip",["SHOW_TOOLTIP"]),{appendPhoto:function(t){var r=this;if(!1!==this.$validate()){var e=t.target.files[0];this.work.photo=e;var o=new FileReader;try{o.readAsDataURL(e),o.onload=function(){r.renderedPhotoUrl=o.result}}catch(t){console.error(t.message)}}},addNewWork:function(){var t=n(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$validate();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,r=this.createWorkFormData(),t.next=9,this.addWork(r);case 9:this.SHOW_TOOLTIP({type:"success",text:"Работа добавлена"}),this.CLOSE_FORM(),t.next=17;break;case 13:t.prev=13,t.t1=t.catch(5),console.error(t.t1.message),this.SHOW_TOOLTIP({type:"error",text:"Произошла ошибка"});case 17:case"end":return t.stop()}},t,this,[[5,13]])}));return function(){return t.apply(this,arguments)}}(),createWorkFormData:function(){var t=new FormData;return t.append("title",this.work.title),this.WorkForm.editMode?t.append("techs",this.editedTagsAsString):t.append("techs",this.work.techs),t.append("photo",this.work.photo),t.append("link",this.work.link),t.append("description",this.work.description),t},setEditedWork:function(){this.work=l({},this.editedWork),this.renderedPhotoUrl=this.remotePhotoPath},saveEditedWork:function(){var t=n(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$validate();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,r={id:this.work.id,data:this.createWorkFormData()},t.next=9,this.editWork(r);case 9:this.SHOW_TOOLTIP({type:"success",text:"Работа обновлена"}),this.CLOSE_FORM(),t.next=17;break;case 13:t.prev=13,t.t1=t.catch(5),console.error(t.t1.message),this.SHOW_TOOLTIP({type:"error",text:"Произошла ошибка"});case 17:case"end":return t.stop()}},t,this,[[5,13]])}));return function(){return t.apply(this,arguments)}}()}),created:function(){this.WorkForm.editMode&&(this.setEditedWork(),this.work.techs="")}},u=(e(445),e(94)),p=Object(u.a)(d,o,[function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"form__upload-photo-content"},[r("span",{staticClass:"form__upload-photo-desc"},[this._v("Перетащите или загрузите для загрузки изображения")]),r("div",{staticClass:"btn--upload-work-photo"},[this._v("Загрузить")]),r("div",{staticClass:"form__upload-photo-content-tablets"},[this._v("Изменить превью")])])}],!1,null,"4f7bd253",null);p.options.__file="src/admin/components/works/work-form.vue";r.default=p.exports}}]);